# 分布式架构的问题与思考

## **面临的问题**

1. 传统的单体架构系统容量显然是有上限的
2. 有计划和无计划的下线时间，系统的可用性也是有极限的.

分布式系统为以上两个问题提供了解决方案，并且还附带有其他优势。
但是，要同时解决这两个问题决非易事。为了构建分布式系统，我们面临的主要问题如下:

1. 分布式系统的硬件故障发生率更高，故障发生是常态，需要尽可能地将运维流程自动化。
2. 需要良好地设计服务，避免某服务的单点故障对依赖它的其他服务造成大面积影响。
3. 老的服务可能是异构的，此时需要让它们使用标准的协议，以便可以被调度、编排，且互相之间可以通信。
4. 服务软件故障的处理也变得复杂，需要优化的流程，以加快故障的恢复。
5. 为了管理各个服务的容量，让分布式系统发挥出最佳性能，需要有流量调度技术。
6. 分布式存储会让事务处理变得复杂；在事务遇到故障无法被自动恢复的情况下，手动恢复流程也会变得复杂。
7. 测试和查错的复杂度增大。
8. 系统的吞吐量会变大，但响应时间会变长。

## **针对的答案**

1. 完善的监控系统，以便对服务运行状态有全面的了解
2. 设计服务时要分析其依赖链；当非关键服务故障时，其他服务要自动降级功能，避免调用该服务
3. 为老的服务编写接口逻辑来使用标准协议，或在必要时重构老的服务以使得它们有这些功能
4. 自动构建服务的依赖地图，并引入好的处理流程，让团队能以最快速度定位和恢复故障
5. 使用一个 [API Gateway](https://www.redhat.com/zh/topics/api/what-does-an-api-gateway-do#:~:text=API%20%E7%BD%91%E5%85%B3%E6%98%AF%E4%BD%8D%E4%BA%8E%E5%AE%A2%E6%88%B7,%E5%B9%B6%E8%BF%94%E5%9B%9E%E7%9B%B8%E5%BA%94%E7%9A%84%E7%BB%93%E6%9E%9C%E3%80%82)，它具备服务流向控制、流量控制和管理的功能
6. 事务处理建议在存储层实现；根据业务需求，或者降级使用更简单、吞吐量更大的最终一致性方案，或者通过[二阶段提交](https://zh.wikipedia.org/wiki/%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4)、[Paxos](https://zh.wikipedia.org/wiki/Paxos%E7%AE%97%E6%B3%95)、[Raft](https://zh.wikipedia.org/wiki/Raft)、[NWR](https://cloud.tencent.com/developer/article/1763152) 等方案之一，使用吞吐量小的强一致性方案
7. 通过更真实地模拟生产环境，乃至在生产环境中做灰度发布，从而增加测试强度；同时做充分的单元测试和集成测试以发现和消除缺陷；最后，在服务故障发生时，相关的多个团队同时上线自查服务状态，以最快地定位故障原因
8. 通过异步调用来减少对短响应时间的依赖；对关键服务提供专属硬件资源，并优化软件逻辑以缩短响应时间